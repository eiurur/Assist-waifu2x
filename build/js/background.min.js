$(function(){var clickHandler,get,notify;return get=function(key){return new Promise(function(resolve,reject){return chrome.storage.sync.get(key,function(item){return resolve(item[key])})})},clickHandler=function(info,tab){return Promise.all([get("aw2x_style"),get("aw2x_noise"),get("aw2x_scale"),get("aw2x_is_allowed_download_original_size"),get("aw2x_is_allowed_only_show_expanded_image")]).then(function(itemList){var url;return info.style=itemList[0],info.noise=itemList[1],info.scale=itemList[2],info.isAllowedDownloadOriginalSize=itemList[3],info.isAllowedOnlyShowExpandedImage=itemList[4],info.uid=Date.now(),url="../build/views/views/asyncpost.html?uid="+info.uid+"&srcUrl="+info.srcUrl+"&style="+info.style+"&noise="+info.noise+"&scale="+info.scale+"&isAllowedDownloadOriginalSize="+info.isAllowedDownloadOriginalSize+"&isAllowedOnlyShowExpandedImage="+info.isAllowedOnlyShowExpandedImage,chrome.tabs.create({url:url,active:!1},function(tab){return void 0})})},chrome.contextMenus.create({title:"image to waifu2x",contexts:["image"],id:"image"}),chrome.contextMenus.onClicked.addListener(clickHandler),notify=function(params,callback){var opts;return opts={title:params.title,message:params.message,type:"basic",iconUrl:"../build/images/icon128.png"},chrome.notifications.create(opts,function(){return void 0})},chrome.runtime.onMessage.addListener(function(request,sender,sendResponse){return chrome.tabs.getAllInWindow(null,function(tabs){return tabs.forEach(function(tab){return-1!==tab.url.indexOf(request.uid)?"show"===request.type?("success"===request.status&&notify({title:"Success",message:request.uid+".png"}),void("failure"===request.status&&notify(null!=request.data?{title:"Failure",message:request.data.error.text+"\n\n"+request.data.body.url}:{title:"Failure",message:request.uid+"\n\nServer Down"}))):("success"===request.status&&setTimeout(function(){return chrome.tabs.remove(tab.id,function(){return void 0})},1e3),"failure"===request.status?setTimeout(function(){return chrome.tabs.remove(tab.id,function(){return void 0}),notify(null!=request.data?{title:"Failure",message:request.data.error.text+"\n\n"+request.data.body.url}:{title:"Failure",message:request.uid+"\n\nServer Down"})},1e3):void 0):void 0})})})});