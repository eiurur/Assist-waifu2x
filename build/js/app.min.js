!function(){var cloneImage,convert,create,deleteWaifu2xElement,download,handleSend2Waifu2x,handleWaifuWrapperOverlay,post2CorsServer,saveBlobImage;return convert={base64toBlob:function(_base64){var arr,blob,data,i,mime,tmp;for(i=void 0,tmp=_base64.split(","),data=atob(tmp[1]),mime=tmp[0].split(":")[1].split(";")[0],arr=new Uint8Array(data.length),i=0;i<data.length;)arr[i]=data.charCodeAt(i),i++;return blob=new Blob([arr],{type:mime}),Blob},toArrayBuffer:function(buffer){var ab,i,view;for(ab=new ArrayBuffer(buffer.length),view=new Uint8Array(ab),i=0;i<buffer.length;)view[i]=buffer[i],++i;return ab}},saveBlobImage=function(data){var arrayBuffer,blob,filename;return console.log(data),arrayBuffer=convert.toArrayBuffer(data.body.data),blob=new Blob([arrayBuffer],{type:data.type}),filename=Date.now()+".png",saveAs(blob,filename)},download=function(blob,filename){var a,e,objectURL;objectURL=(window.URL||window.webkitURL).createObjectURL(blob),a=document.createElement("a"),e=document.createEvent("MouseEvent"),a.download=filename,a.href=objectURL,e.initEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(e)},post2CorsServer=function(params){return console.log(params),alertify.log("変換中です。 しばらくお待ちください。"),$.ajax({type:"POST",url:"https://renge.herokuapp.com/api/downloadFromURL",data:params,headers:{"Access-Control-Allow-Origin":"*"}}).done(function(data){return data.error?(console.log("Error Code = ",data.error.status),console.log("Error text = ",data.error.text),console.log("data.body.url = ",data.body.url),void alertify.error("変換に失敗しました。<br>ErrorCode: "+data.error.status+".<br>ErrorText: "+data.error.text+".<br>画像URL: "+data.body.url)):(console.log(data),saveBlobImage({body:data.body,type:data.type}),alertify.success("変換に成功しました。"),console.log("done"))}).fail(function(jqXHR,textStatus){return console.log("jqXHR = ",jqXHR),console.log(textStatus),alertify.error("変換に失敗しました。"),console.log("fail")})},create={waifu2x__wrapper:function(elem){var html;return html='<span class="waifu2x__wrapper"/>',$(elem).wrap(html)},"waifu2x__wrapper-overlay":function(elem){var html;return elem=$(elem).parent(".waifu2x__wrapper"),html='<div class="waifu2x__wrapper-overlay"/>',$(elem).append(html)},button:function(elem){var elem2,html;return elem2=$(elem).next(),html='<div class="btn-group waifu2x__button__wrapper" role="group">\n  <button type="button" class="btn btn-default waifu2x__button" value="0">x1</button>\n  <button type="button" class="btn btn-default waifu2x__button" value="1">x1.6</button>\n  <button type="button" class="btn btn-default waifu2x__button" value="2">x2</button>\n</div>',$(elem2).append(html)}},cloneImage=function(elem){return console.log(elem),$(elem).clone().wrap(".waifu2x__wrapper")},deleteWaifu2xElement=function(){return $(".waifu2x__button__wrapper").remove(),$(".waifu2x__wrapper-overlay").remove(),$(".waifu2x__wrapper").remove()},handleWaifuWrapperOverlay=function(elem){return $(document).on("mouseleave",".waifu2x__wrapper",function(){return cloneImage(elem),deleteWaifu2xElement()})},$(document).on("mouseenter","img",function(){return $(this).parent(".waifu2x__wrapper").length?void console.log($(this).parent(".waifu2x__wrapper")):(create.waifu2x__wrapper(this),create["waifu2x__wrapper-overlay"](this),create.button(this),handleSend2Waifu2x(this))}),handleSend2Waifu2x=function(elem){return console.log("aaa"),$(elem).next().find(".waifu2x__button").each(function(){$(this).on({click:function(){var scale,src;return src=$(this).parent().parent().prev("img").attr("src"),scale=$(this).val(),post2CorsServer({url:src,noise:1,scale:scale-0}),!1}})})}}();